# ESLint Command VS Code Extension - AI Agent Instructions

## Big Picture

- This project is a VS Code extension for `eslint-plugin-command`, implemented with `reactive-vscode`.
- Entry point is `src/index.ts`, which wires three feature modules: annotations, completions, and insert-command.
- Data flow is: built-in commands (`src/constants/commands.ts`) + user commands (`eslint-command.commands`) → merged by `useESLintCommands()` → consumed by all features.

## Core Modules

- `src/features/annotations.ts`: scans document text for command triggers and renders decorations.
  - Uses `ohash` for text-change detection and a 300ms debounce for text updates.
  - Escapes trigger strings via `escapeRegExp` before building regex.
- `src/features/completions.ts`: registers completion provider on all languages, then filters per request using `getLanguageIds()`.
  - Trigger chars are fixed: space after `///` and `@` after `// `.
- `src/features/commands.ts`: `eslint-command.insert-command` quick pick + snippet insertion.
  - Language checks should use `getLanguageIds()` (same source as other features).

## Config & Generated Metadata

- Use `defineConfig` in `src/config.ts` (not `defineConfigObject`).
- `src/meta.ts` is generated by `vscode-ext-gen`; do not edit manually.
  - Change `package.json` contributes/config schema, then run `pnpm generate:meta`.
- Language validation is centralized in `getLanguageIds()` and warns invalid IDs via VS Code UI.

## Dev Workflows

- `pnpm dev`: watch build (tsdown)
- `pnpm build`: production build
- `pnpm typecheck`: type check via `tsgo --noEmit`
- `pnpm lint`: lint via `oxlint`
- `pnpm format` / `pnpm format:check`: formatting via `oxfmt`
- CI (`.github/workflows/ci.yml`) runs install + lint + build + typecheck.

## Project Conventions (Important)

- Prefer reactive primitives (`computed`, `watch`, `shallowRef`) over ad-hoc imperative state.
- Reuse composables (`useESLintCommands`) instead of duplicating merge logic.
- Avoid noisy logs in hot paths (e.g., per-match annotation loops).
- Keep user-facing behavior consistent across features by sharing `getLanguageIds()`.
- Preserve ES module style and typed meta keys (`commands.insertCommand`, scoped config keys).

## Integration Notes

- External runtime deps intentionally bundled via `tsdown` config (`reactive-vscode`, `ohash`), while `vscode` is never bundled.
- Extension activates on `onStartupFinished`, so guard feature setup with `config.enable`.
